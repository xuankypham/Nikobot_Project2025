<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Two Cameras Display</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            text-align: center;
            margin: 0;
            padding: 20px;
            height: 100vh;
        }
        h2 {
            color: #333;
        }
        .image-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            width: 100%;
            height: 60%;
            padding: 20px;
            background: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }
        .camera {
            text-align: center;
            width: 640px;
            height: 580px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;


        }
        img {
            width: 90%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            background-color: #ddd;
            padding: 10px;
        }
        button {
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #007BFF;
            color: white;
        }
        button:hover {
            background-color: #0056b3;
        }
        @media (max-width: 768px) {
            .image-container {
                flex-direction: column;
                height: auto;
                align-items: center;
            }
            .camera {
                width: 100%;
                height: auto;
            }
            img {
                width: 100%;
                height: auto;
            }
        }



/* -------------------NAVIGATION BAR------------ */
 body {font-family: Arial, Helvetica, sans-serif;}

.navbar {
  width: 100%;
  background-color: #555;
  overflow: auto;
}

.navbar a {
  float: left;
  padding: 12px;
  color: white;
  text-decoration: none;
  font-size: 17px;
}

.navbar a:hover {
  background-color: #000;
}

.active {
  background-color: #4CAF50;
}

@media screen and (max-width: 500px) {
  .navbar a {
    float: none;
    display: block;
  }
}

.dropdown {
  float: left;
  overflow: hidden;
}

.dropdown .dropbtn {
  font-size: 16px;
  border: none;
  outline: none;
  color: white;
  padding: 14px 16px;
  background-color: inherit;
  font-family: inherit;
  margin: 0;
}

.navbar a:hover, .dropdown:hover .dropbtn {
  background-color: red;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f9f9f9;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

.dropdown-content a {
  float: none;
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.dropdown-content a:hover {
  background-color: #ddd;
}

.dropdown:hover .dropdown-content {
  display: block;
}




        .table-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            width: 90%;
            height: 70%;
            padding: 20px;
            background: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }
        .table_set {
            text-align: center;
            width: 50%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;


        }



        #eventcamera {
  width: 80%;
  height: 25%;
  background-color: lightblue;

}
table, td{
    text-align: left;

}

    </style>
</head>
<body>

<div class="navbar">
      <div class="dropdown">

    <button class="dropbtn"style="font-size:20px"><i class="fa fa-bars"></i> Menu </button>
    <div class="dropdown-content" >
      <a class="active" href="index.html"><i class="fa fa-fw fa-home"></i> Home</a>
      <a class="fa fa-cog" aria-hidden="true" href="setup.html">  Setup</a>
      <a class="fa fa-credit-card" aria-hidden="true" href="datamonitor.html">datamonitor</a>
       <a class="fa fa-credit-card" aria-hidden="true" href="wsdata.html"> wsdata</a>
       <a class="fa fa-credit-card" aria-hidden="true" href="map_control.html"> Mapcontrol</a>
       <a class="fa fa-credit-card" aria-hidden="true" href="mqttdata.html"> mqttdata</a>

       <a class="fa fa-credit-card" aria-hidden="true" href="camera.html" target=”_blank”> Camera</a>
        <a class="fa fa-credit-card" aria-hidden="true" href="rplidar.html" target=”_blank”> RPlidar</a>
        <a class="fa fa-address-book-o" aria-hidden="true" href="autocontrol.html"> Autocontrol</a>
     <a class="fa fa-address-book-o" aria-hidden="true" href="about.html"> About</a>
     <a class="fa fa-address-book-o" aria-hidden="true" href="help.html"> help</a>


	  </div>
</div>
    <p style="color:rgb(71, 243, 255) ; margin-top: 20px;font-size: 20px;"> <i class="fa fa-fw fa-user"></i> XuankyAutomation| <span id="wifilogo"> <i class="fa fa-wifi" style="color: lime" aria-hidden="true"></i> </span>   <span id="wifirssi"> 0 </span>%</p>
</div>


<!-----------------MAIN PROGRAM-------------------->


 <h2>Two Cameras Display</h2>
    <div class="image-container">
        <div class="camera">
            <h3>Camera No1</h3>
            <img id="camera1" src="placeholder1.jpg" alt="Camera 1 Feed">
            <br>
            <button onclick="startCam(1)">Start Cam 1</button>
            <button onclick="stopCam(1)">Stop Cam 1</button>
        </div>
        <div class="camera">
            <h3>Camera No2</h3>
            <img id="camera2" src="placeholder2.jpg" alt="Camera 2 Feed">
            <br>
            <button onclick="startCam(2)">Start Cam 2</button>
            <button onclick="stopCam(2)">Stop Cam 2</button>
        </div>
    </div>


<hr> <br>
<button id = "showhideevent" onclick ="show_hide_event()"> SHOW CAMERA EVENT</button> 

<div id = "eventcamera" style="text-align: center; display: block; width:100%">
<table style="text-align: left; width:100%" >
<tr> <td style="width: 10%;">  EVENT CAMERA 1 </td>     <td > <textarea style ="width: 100%; height:50px" id = "camera1event">    </textarea> </td></tr>

<tr> <td style="width: 10%;">  EVENT CAMERA 2 </td>     <td> <textarea style ="width: 100%; height:50px" id = "camera2event">    </textarea></td></tr>
<tr> <td style="width: 10%;">  EVENT MQTT </td>     <td> <textarea style ="width: 100%; height:100px" id = "mqtt_event">    </textarea></td></tr>
</table>

</div>




<hr>
<div class="image-container" >
    <div class="camera">
<h4> Setup MQTT</h4>
    <table>
    <tr>
       <td> Broker :</td>  <td> <input type="text" id ="broker" value="broker.emqx.io"></td>  </tr>
        <td> Port :</td>  <td> <input type="text" id="port" value="1883"></td>  </tr>
        <td> UserName :</td>  <td> <input type="text" id = "username" value="robot"></td>  </tr>
        <td> Password :</td>  <td> <input type="text" id = "password" value="123456"></td>  </tr>
        <tr><td colspan="2"><button onclick="setmqtt()">SETMQTT</button></td></tr>

    </table>
        </div>


    <div  class="camera">
<h4> Setup Intel RealSens CAMERA 1</h4>
    <table>
    <tr>
       <td colspan="2"> Set Minimum Safety distance Alarm and Trip</td>    </tr>
        <td> Alarm (m) :</td>  <td> <input type="text" id="alarm_dist" value ='3'></td>  </tr>
        <td> Stop (m) :</td>  <td> <input type="text" id = "stop_dist" value="1"></td>  </tr>
        <tr> <td> <div id="checkbox-container">
        <label><input type="checkbox" class="checkbox-item" id="person" checked> person </label><br>
        <label><input type="checkbox" class="checkbox-item" id="bicycle"> bicycle </label><br>
        <label><input type="checkbox" class="checkbox-item" id="car"> car</label><br>
        <label><input type="checkbox" class="checkbox-item" id="motorcycle"> motorcycle</label><br>
        </div> </td>
            <td>

                <div id="checkbox-container1">
        <label><input type="checkbox" class="checkbox-item" id="bus"> bus</label><br>
        <label><input type="checkbox" class="checkbox-item" id="train"> train</label><br>
        <label><input type="checkbox" class="checkbox-item" id="truck"> truck</label><br>
        <label><input type="checkbox" class="checkbox-item" id="dog"> dog</label><br>
        </div>
            </td>

        </tr>
        <tr> <td> <input type="checkbox" class="checkbox-item" id="cam_intel_enb"> Enable</td><td ><button onclick="setRealsecam()">Set Safety</button></td></tr>
    </table>
        </div>

    <div  class="camera">
<h4> Setup Logitect CAMERA 2</h4>
    <table >
    
        <tr><td colspan="2">Enable or Disable Control by Image</td></tr>
        <tr><td> Cam/Video link :</td>  <td> <input type="file" id="fileInputCam" name="file" accept="video/mp4,video/x-m4v,video/*" onchange="showFilePathCam()" /> </td>  </tr>
        <tr><td> Pre_Train Model :</td>  <td> <input type="file" id="fileInputModel" name="file" multiple accept=".pt" onchange="showFilePathModel()" /></td>  </tr>
        <tr><td colspan="2"> <label><input type="checkbox" class="checkbox-item" id="cam2_enb_ctr"> Enable Control</label></td>  </tr>
        <tr><td>  <label><input type="checkbox" class="checkbox-item" id="webcam_select" checked> WebCam</label></td>
        <td> <label> WebcamID: </label><input id="webcam_index" value="1" style="width : 50px"></td>
        </tr>

        <tr><td colspan="2"><button onclick="setcamera_logitect()">Set Camera logitect</button></td></tr>



    </table>

        </div>

  </div>

<div >
<button onclick="savesetting()">  SAVE SETTING DATA</button>
    <button onclick="readsetting()">  READ SETTING DATA</button>
    <label>HOST IP ADDRESS</label> <input type="text" id="ip" placeholder="192.168.0.100:8000" style="color:blue">
    <button onclick="listWebcam()"> LIST WEBCAM</button>

<h4> OPERATION EVENT DISPLAY</h4>
    <textarea id =  "event" style="width :100%; height:300px" >

    </textarea>


    </div>




	<!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script> -->
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.0/socket.io.min.js"></script> -->
   <script type = "text/javascript" src="{{ url_for('static', filename='js/socket48.io.min.js') }}"></script>

    <script type="text/javascript">

        // -----------Global Variable---------------------------------------------------------
        var data_event =document.getElementById('event');
        var alarm_dist =document.getElementById('alarm_dist');
        var stop_dist =document.getElementById('stop_dist');
        var cam_intel_enb = document.getElementById('cam_intel_enb');







     var socket = io.connect('http://' + document.domain + ':' + location.port);

     //----------------------------------------------------------------------------
     function get_currentdatetime(){
     var currentdate = new Date();

        var datetime = currentdate.getDate() + "/"+(currentdate.getMonth()+1)
        + "/" + currentdate.getFullYear() + " @ "
        + currentdate.getHours() + ":"
        + currentdate.getMinutes() + ":" + currentdate.getSeconds();
        return datetime

     }

     socket.on('connect' ,function()
     {
     	socket.emit('check' ,{data: 'User Connected'})
     });
     socket.on('camera1', function(msg)
     {  
        //console.log(image)
        const image_element=document.getElementById('camera1');
        image_element.src="data:image/jpeg;base64,"+msg;
     });

     socket.on('camera2', function(msg)
     {
        //console.log(image2)
        const image_element=document.getElementById('camera2');
        image_element.src="data:image/jpeg;base64,"+msg;
     });
        function startCam(n){
        var dt = get_currentdatetime();

        if (n==1){
        socket.emit('start1');
        data_event.append(dt + ": " + "Start CAM 1 IntelRealsens \n");
        }else{
        socket.emit('start2');
        data_event.append(dt + ": " + "Start CAM 2 Logitect \n");

        }

        }


        function stopCam(n){
                var dt = get_currentdatetime();
        if (n==1){
        socket.emit('stop1');
           data_event.append(dt + ": " + "Stop CAM 1 IntelRealsens \n");

        }else{
        socket.emit('stop2');
           data_event.append(dt + ": " + "Stop CAM 2 Logitect \n");

        }

        }
//----------------------------MQTT---------
        function setmqtt() {
            const broker = document.getElementById('broker').value;
            const port = parseInt(document.getElementById('port').value);
            const user = document.getElementById('username').value;
            const pass = document.getElementById('password').value;
            data = { broker: broker, port: port ,user:user, pass:pass};
            socket.emit('setup_mqtt',data );
            
            var dt = get_currentdatetime();
            var msg_string = JSON.stringify(data) +"\n"; //String

            data_event.append(dt + ": " + "Setup MQTT Broker  Data: " + msg_string +"\n");
        }
// Realses Camera

        function setRealsecam(){
            

            var classes =[];
            var cam_intel_enb=false;
            var dist_alarm = parseFloat(alarm_dist.value);
            var dist_stop = parseFloat(stop_dist.value);
            var cam_intel_enb

            
            if (document.getElementById('person').checked){classes.push(0);}
            if (document.getElementById('bicycle').checked){classes.push(1);}
            if (document.getElementById('car').checked){classes.push(2);}
            if (document.getElementById('motorcycle').checked){classes.push(3);}
            if (document.getElementById('bus').checked){classes.push(5);}
            if (document.getElementById('train').checked){classes.push(6);}
            if (document.getElementById('truck').checked){classes.push(7);}
            if (document.getElementById('dog').checked){classes.push(16);}

            if (document.getElementById('cam_intel_enb').checked){cam_intel_enb=true;} else{cam_intel_enb=false;}

            if (classes.length>0){
            var data = { cam_intel_enb:cam_intel_enb, classes:classes, alarm_dist:dist_alarm, stop_dist:dist_stop, enb_safety_cam1:cam_intel_enb}

            socket.emit('setup_intelCam', data);
            var dt = get_currentdatetime();
            var msg_string = JSON.stringify(data) +"\n"; //String

            data_event.append(dt + ": " + "Setup IntelRealsens CAM 2 Data: " + msg_string +"\n");

             }else{alert(" Objects Detection are not checked, Click Checkbox please");}



        }

 //--------------------------Video Cam2 path----------------
var FileCamInput = ""; 
var FileCamModel = "";
var video_input= 1;
        function showFilePathCam() {
            const fileInputCam = document.getElementById('fileInputCam');

            // Display file path (local path is not accessible due to security restrictions)

            if (fileInputCam.files.length > 0) {
                FileCamInput= fileInputCam.files[0].name;
            } else {
                FileCamInput = "";
            }
        }

        function showFilePathModel() {
            const fileInputModel = document.getElementById('fileInputModel');


            // Display file path (local path is not accessible due to security restrictions)

            if (fileInputModel.files.length > 0) {
                FileCamModel= fileInputModel.files[0].name;
            } else {
                FileCamModel = "";
            }

        }


        function setcamera_logitect(){
            var video_input;
            var  cam_link;
            var cam2_control = false;

            if (FileCamModel ==""){ FileCamModel = "yolov10n.pt" ;}

            if (FileCamInput ==""){ FileCamInput = "Traffic1.mp4" ;}

            var cam2_control_enb = document.getElementById("cam2_enb_ctr");


            if (cam2_control_enb.checked){ cam2_control =true;} else{ cam2_control =false;}

            var cam2_index = parseInt(document.getElementById("webcam_index").value);

            var cam2_sel = document.getElementById("webcam_select");

            if (cam2_sel.checked) { video_input = cam2_index;} else{video_input= FileCamInput}








            data ={"cam2_video_link": video_input, "cam2_model_link": FileCamModel, "cam2_ctrl_enb": cam2_control}
            socket.emit('setup_logitectCam', data);

            var dt = get_currentdatetime();
            var msg_string = JSON.stringify(data) +"\n"; //String
            data_event.append(dt + ": " + "Setup Logitect CAM 2 Data: " + msg_string +"\n");



        }


        //------------------------------------------------
        function savesetting(){
        socket.emit('write_setting');
        }
         function readsetting(){
        socket.emit('read_setting');
        }

readsetting();

     socket.on('datasetup', function(msg)
     {
        //Msg is Json Object
        var msg_string
        if ('mqtt' in msg){
            msg_string = JSON.stringify(msg) +"\n"; //String

            
            document.getElementById("broker").value = msg['mqtt']['broker']
            document.getElementById("port").value = msg['mqtt']['port']
            document.getElementById("username").value = msg['mqtt']['user']
            document.getElementById("password").value = msg['mqtt']['pass']


        //------------------Realsens Camera---------------
        document.getElementById("alarm_dist").value=msg['intelCam']['alarm_dist'];
        document.getElementById("stop_dist").value=msg['intelCam']['stop_dist'];
        if(msg['intelCam']['cam_intel_enb']){
        document.getElementById("cam_intel_enb").checked =true;
        }

        var cls = msg['intelCam']['classes']
        for (var i=0; i<cls.length;i++){
            if (i==0){ document.getElementById('person').checked =true;}
            if (i==1){ document.getElementById('bicycle').checked =true;}
            if (i==2){ document.getElementById('car').checked =true;}
            if (i==3){ document.getElementById('motorcycle').checked =true;}
            if (i==5){ document.getElementById('bus').checked =true;}
            if (i==6){ document.getElementById('train').checked =true;}
            if (i==7){ document.getElementById('truck').checked =true;}
            if (i==16){ document.getElementById('dog').checked =true;}
        }

    //-----------------------Logitect---------------


              if (msg['logitectCam']['cam2_ctrl_enb']){
              document.getElementById('cam2_enb_ctr').checked =true;
              }
               

        


            } else{
            msg_string =msg
            }


         var dt = get_currentdatetime();
         data_event.append(dt + ": " + "Data: " + msg_string +"\n");


        

     });

     socket.on('host_ip', function(msg)
     {
        //Msg is Json Object

        document.getElementById('ip').value = "http://" + msg.ip + ":"+ msg.port;

        var msg_string = JSON.stringify(msg) +"\n"; //String


        data.append(msg_string)
     });



        socket.emit('getdata_web');


      function listWebcam(){
         socket.emit('get_webcamID');

        }



//---------------------------------------------
socket.on('camera2event', function(msg)
     {
        //console.log(image2)
        const event=document.getElementById('camera2event');
        
        
        var msg_string = JSON.stringify(msg) ; //String
        event.textContent =msg_string;
     });

     socket.on('camera1event', function(msg)
     {
        //console.log(image2)
        const event=document.getElementById('camera1event');
        
        
        var msg_string = JSON.stringify(msg) ; //String
        event.textContent =msg_string;
     });




     socket.on('control_event', function(msg)
     {
        //Msg is Json Object
        var msg_string
        var dt = get_currentdatetime();

        msg_string = JSON.stringify(msg) +"\n"; //String
     
        var data_event=document.getElementById('event');
        data_event.append(dt + ": " + "Operate Robot: " + msg_string +"\n");



     });


    // Receive event from Intel realsens camera to stop or warning
     socket.on('camera1safetyevent', function(msg)
     {
        //Msg is Json Object
        var dt = get_currentdatetime();

        var data_event=document.getElementById('event');
        data_event.append(dt + " Message:  " + msg +"\n");



     });


       var index_msg_mqtt = 0
        socket.on('mqtt_cam_event', function(msg)
     {
        //console.log(msg)
        const event = document.getElementById('mqtt_event');

        var dt = new Date();
              msg_string = JSON.stringify(msg) +"\n"; //String


        if (index_msg_mqtt<3){
            event.append (dt + ": " + msg_string);
            index_msg_mqtt = index_msg_mqtt+1;
            }else{index_msg_mqtt =0;  event.textContent="";}


     });


 </script>


<script>

    //--------------------------------------
    function show_hide_event() {
  var x = document.getElementById('eventcamera');
  if (x.style.display === 'none') {
    x.style.display = 'block';
    document.getElementById("showhideevent").textContent="HIDE CAMERA EVENT";

  } else {
    x.style.display = 'none';
    document.getElementById("showhideevent").textContent="SHOW CAMERA EVENT";

  }
}



</script>




</body>
</html>
